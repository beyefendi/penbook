# Information gathering

- We have 7 attack surfaces

## Hardware

A hardware pentest involves both hardware equipment and software utilities. 
The exploitation of hardware physical interfaces covers dumping firmware, backdooring firmware, granting shell access, changing code execution, misusing test functionality, exploiting known vulnerabilities in third-party chips, examining external media interfaces, sensitive data exposure, and tampering resistance.
The usual findings in hardware pentests use the SD card slot for modified firmware upgrades and exploiting known vulnerabilities for the Wi-Fi stack of the processor.
The exploitation of a hardware component almost always results in privilege escalation because the devices usually implicitly trust anyone with physical access.
One of the key points in hardware pentesting is that although the functionality of the devices differs, the general approach remains the same. 
We developed a testing guideline for [hardware](iot/guidelines/hardware) and define 17 potential weaknesses, as listen in [Top 100 weaknesses](iot/weaknesses.md) for the hardware attack surface.


## Firmware

After dumping the firmware, the file system inside is then extracted for analysis.
We start with the static analysis of the file system to reveal sensitive data: hash, password, private certificate, encryption/encoding keys, API key, and staging URL (e.g., firmware update).
Credentials are usually used for the administrative accounts of client interfaces or default root credentials of the firmware.
Additionally, we search for the configurations of the security settings. 
Subsequently, we use certain techniques to identify specific vulnerabilities that result in command injection or authentication bypass.
In this scope, libraries that often contain sensitive data are reverse engineered (for certain architectures ARM and MIPS), critical functions are disassembled in detail, and main binaries are emulated for dynamic analysis (debugging).
We also perform fuzzing attacks to identify heap overflow vulnerabilities. 
The firmware is also fully emulated to perform detailed network services and web application pentesting.
Finally, we analyze the update mechanisms, such as forcing the installation of a custom (malicious) firmware update. 
Firmware is an essential component in any IoT vulnerability research that helps reveal many secrets about the device and contributes to other attack surfaces.
We developed a testing guideline for [firmware](iot/guidelines/firmware) and also suggest looking at the firmware security test method of [OWASP](https://github.com/scriptingxss/owasp-fstm).
We define 23 potential weakness, as listed in [Top 100 weaknesses](iot/weaknesses.md) for firmware.


## Radio

Depending on the communication protocol, specialized equipment is required to perform specific radio pentests.
To conduct attacks, it is necessary to first sniff the radio traffic.
The ability to extract sensitive information in clear text from radio packets is common.
Even if the communication is encrypted, it is possible to decrypt traffic. 
We look for TLS connections to determine whether they are vulnerable to MitM attacks.
When certificate validation is missing, it usually allows further attacks according to context.
Replaying is a critical attack because the captured data can be replied to when there is no message verification.
If payload verification has already taken place, then a signal-jamming attack is conducted to capture an unused radio packet for replaying.
We also cover reverse engineering and fuzzing unknown/custom protocols, decoding data packets, live radio communication interception and modification, session hijacking, and spoofing attacks.
As Bluetooth low energy (BLE), software-defined radio (SDR), and ZigBee are prevalent, we developed testing [guidelines](iot/guidelines/radio) for them.
Although different weaknesses are observed in different radio protocols, weaknesses that are common to all protocols also exist.
We define the 7 potential weaknesses, as listed in [Top 100 weaknesses](iot/weaknesses.md) for radio protocols. 


## Network

Although we execute traditional network pentesting techniques for device network services, we highlight the following points for the IoT scope.
In reconnaissance activity, the network services with their versions were discovered.
Now, the corresponding known vulnerabilities on these versions are found online.
[Network vulnerability scanners](https://tenable.com/products/nessus) can automatically match vulnerabilities to those in their built-in database.
Semi-automated fuzzing techniques are applied, especially for unfamiliar services, to identify any potential buffer overflow. 
IoT network services running older versions continue to prevail. These versions usually have common weaknesses, such as a service that accepts connections without any authentication or insecure transport encryption, which usually results in the exposure of sensitive data.
Exposed network services or services providing remote access/management are also common.
In the case in which default accounts do not exist, brute force attacks are performed against authentication mechanisms to discover user credentials.
Finally, we sometimes observe protocol vulnerabilities attributable to insecure service configurations.
In this scope, we define the 11 potential weaknesses for network services, as listed in [Top 100 weaknesses](iot/weaknesses.md).
Several comprehensive sources provide guidelines for conducting a network penetration test from start to end.


## Cloud

Although cloud services appear to be web applications, the cloud component tends to be served through the WebSocket protocol rather than traditional web requests.
Our observations on the cloud are as follows: Contrary to popular belief, the cloud is perhaps the most robust component in IoT devices; traditional weaknesses (e.g., SQL injection) are not very common here.
On the other hand, gateway or mobile applications typically use these APIs.
Therefore, it is common to find hard-coded API keys from firmware or mobile apps.
The lack of TLS pinning and misconfigured microservices (unauthenticated cache or metadata services) is also typical. 
Reverse engineering of communication APIs (e.g., REST, SOAP) reveals additional secrets, including possible undocumented features (e.g., hidden sensitive API), and helps identify additional attack surfaces.
The cloud component is known to perform analytical calculations on the data collected from the sensors and can affect the behavior of the sensors according to the results. Therefore, we focus on manipulating the sensor data to be sent to the cloud environment and triggering the cloud engine to activate a malicious action.
The [OWASP WebSockets testing guideline](https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/11-Client_Side_Testing/10-Testing_WebSockets) can be followed to when performing a pentest.
We define 13 potential weaknesses, as listed in [Top 100 weaknesses](iot/weaknesses.md) for cloud protocols.


## Web

We focus on the following security issues for the web applications of the devices.
In an enumeration activity, web pages and the underlying infrastructure (common frameworks) with versions were discovered.
For a custom application with a limited number of web pages, [personal proxy toolkits](https://portswigger.net/burp) are utilized to examine the target (e.g., repeating modified web requests).
Otherwise, various web vulnerability scanners [1](https://w3af.org),[2](https://github.com/wpscanteam/wpscan) are usually executed to obtain insights.
If the file system in firmware is accessible, the source code of a web application is also analyzed in addition to conducting black box pentesting, because this opens doors to finding vulnerabilities, which cannot be found otherwise.
This technique has the greatest potential to discover zero-day vulnerability as well.
Web applications served on IoT devices are usually wrappers for internal operating system utilities, such as ping.
User inputs are passed to these utilities as parameters, and hence, shell commands are executed.
The most critical weakness here is command injection, where unsanitized input can lead to remote code execution.
Another common vulnerability is the weak authentication mechanism causing authenticated attacks.
These are the common vulnerabilities in devices, but we also suggest following the [OWASP web top 10](https://owasp.org/www-project-top-ten/), [OWASP web testing guidelines](https://owasp.org/www-project-web-security-testing-guide/), and [OWASP application security verification standard](https://owasp.org/www-project-application-security-verification-standard/) to complete the pentest.
In this context, we define 12 potential weakness for web applications, as listed in [Top 100 weaknesses](iot/weaknesses.md).


## Mobile

In the mobile pentest for Android and iOS versions of the application, we focus on the following cases.
First, reverse engineering and source code analysis are required for the vulnerability assessment of mobile applications.
It allows the identification of secrets, including possible undocumented features, which contribute to other attack surfaces.
Common hard-coded sensitive data are the firmware update URL, APK update URL, and cloud API authentication token.
Additionally, the native components of mobile apps often lead to an understanding of various critical functions, such as encryption.
Automated toolkits [1](github.com/iBotPeaches/Apktool),[2](github.com/skylot/jadx) are utilized to decompile and perform static analysis of mobile apps.
The compiled application code, dependent native libraries with versions, resource files, and the requested mobile device permissions were all extracted.
Today, the source code of apps is often obfuscated, making it harder to understand the operation logic.
Therefore, analysis can continue with promising file names to obtain a quick overview.
Additionally, applications store some data locally in the devices; these files are also valuable.
Second, the network traffic is intercepted.
To do this, it is necessary to [bypass SSL pinning](https://github.com/topjohnwu/Magisk) first, and then a [personal proxy](https://portswigger.net/burp) is used to capture network traffic before live analysis.
Finally, dynamic analysis is conducted with [automated toolkits](https://github.com/frida/frida).
It is worth noting that the device may be set up with a default credential (e.g., admin/admin) during the initial setup process.
Additionally, the mobile app may ignore certificate issues (e.g., the application communicates over an insecure channel with non-trusted CA authorities for the SSL certificate).
Furthermore, the firmware update operation is sometimes triggered via a mobile app, which contributes to firmware analysis.
We can follow the [OWASP mobile top 10](https://owasp.org/www-project-mobile-top-10/), [OWASP mobile security testing guide](https://github.com/OWASP/owasp-mstg), and [OWASP mobile application security verification standards](https://github.com/OWASP/owasp-masvs) for further investigation.
We define 17 potential weakness, as listed in [Top 100 weaknesses](iot/weaknesses.md) for mobile apps. 
